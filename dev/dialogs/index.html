<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Dialogs · InfinityEngine.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">InfinityEngine.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../items/">Items</a></li><li class="is-active"><a class="tocitem" href>Dialogs</a><ul class="internal"><li><a class="tocitem" href="#Structure"><span>Structure</span></a></li><li><a class="tocitem" href="#Displaying-dialogs"><span>Displaying dialogs</span></a></li><li><a class="tocitem" href="#Creating-new-dialogs"><span>Creating new dialogs</span></a></li><li><a class="tocitem" href="#Extending-existing-dialogs"><span>Extending existing dialogs</span></a></li><li><a class="tocitem" href="#Inserting-into-existing-dialogs"><span>Inserting into existing dialogs</span></a></li><li><a class="tocitem" href="#Deleting-existing-dialogs"><span>Deleting existing dialogs</span></a></li><li><a class="tocitem" href="#Attaching-data-to-dialogs"><span>Attaching data to dialogs</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Dialogs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Dialogs</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/plut/InfinityEngine.jl/blob/master/docs/src/dialogs.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Dialogs"><a class="docs-heading-anchor" href="#Dialogs">Dialogs</a><a id="Dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Dialogs" title="Permalink"></a></h1><h2 id="Structure"><a class="docs-heading-anchor" href="#Structure">Structure</a><a id="Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Structure" title="Permalink"></a></h2><p>All in-game dialog is encoded as a state machine (a single state machine can represent the whole game dialog). States of this machine correspond to NPC text, while transitions are (usually) PC replies.</p><p>On a given state (when presented when a text), the PC can choose which reply to select, i.e. which transition to follow to a target state. Some transitions are final (they close the dialog instead of having a target state), and some transitions also happen to not have PC text associated.</p><p>Since each state has a NPC speaker, states are indexed by pairs <code>(actor, key)</code>, where the actor is the identity of the speaker; this is also how dialog is encoded in the game files: all dialog belonging to a single actor (states of this actor, and transitions from these states) are stored in a single game resource. Accordingly, the <code>Actor</code> data structure corresponds to all text said by a given NPC speaker, and all PC replies to this text.</p><h2 id="Displaying-dialogs"><a class="docs-heading-anchor" href="#Displaying-dialogs">Displaying dialogs</a><a id="Displaying-dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Displaying-dialogs" title="Permalink"></a></h2><p>Reading an actor is as simple as loading it and letting the REPL display it: just try invoking <code>actor(&quot;imoen&quot;)</code> and look at the result.</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.actor" href="#InfinityEngine.actor"><code>InfinityEngine.actor</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">actor([game], &quot;name&quot;)</code></pre><p>Loads the named actor from game files, or creates an empty actor if none exists with this name.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2356-L2361">source</a></section></article><h2 id="Creating-new-dialogs"><a class="docs-heading-anchor" href="#Creating-new-dialogs">Creating new dialogs</a><a id="Creating-new-dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-new-dialogs" title="Permalink"></a></h2><p>Several functions enable creating and editing game dialogs. The easiest feature is creation of entirely new dialogs. For this, it is enough to give a list of states connected by transitions.</p><p>The currently active actor is selected by the <code>actor</code> function. It is legal to call this on a non-existing actor name; it simply creates an empty actor, to which states and transitions will then be attached.</p><p>The <code>say</code> function creates states, while <code>reply</code> creates transitions. The module maintains a “last added state” variable. This variable is updated by calls to <code>say</code> to the last state added, and used by calls to <code>reply</code> to determine from which state a transition must be created.</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.say" href="#InfinityEngine.say"><code>InfinityEngine.say</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">say({text | (label =&gt; text)}*; priority, trigger)</code></pre><p>Introduces states of dialog for the current actor. If the label is omitted, a default (numeric, increasing) label will be inserted (although inserting an explicit label makes the state easier to reach).</p><p>A single <code>say</code> call is equivalent to several successive <code>say</code> calls for the same current actor.</p><p><strong>Special cases</strong></p><ul><li>implicit, text-less transitions: <code>say(text1) say(text2)</code>;</li><li>multi-say: <code>say(text1, text2, ...)</code> — actually equivalent to the previous form;</li><li>chain with actor change: <code>actor(name1) say(text1) actor(name2) say(text2)...</code>;</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2377-L2394">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.reply" href="#InfinityEngine.reply"><code>InfinityEngine.reply</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reply(text =&gt; label)</code></pre><p>Introduces a state transition (player reply) pointing to the given label. The label may be one of:</p><ul><li><code>(&quot;actor&quot;, state)</code> (equivalently <code>&quot;actor&quot; =&gt; state</code>);</li><li><code>state</code>  (uses current target actor);</li><li><code>exit</code> (creates a final transition).</li></ul><p>State may be either numeric (referring to the base game&#39;s states) or string. In the latter case, if it does not contain a slash, it will be prefixed by the current namespace : <code>&quot;namespace/state&quot;</code>. This prevents states from different namespaces from interfering.</p><p><strong>Special forms:</strong></p><ul><li><code>reply(exit)</code> creates a text-less, final transition;</li><li><code>reply(text)</code> creates a pending transition: this will be connected to the next state inserted (via <code>say</code>).</li></ul><p><strong>Examples:</strong></p><pre><code class="nohighlight hljs"># chain to other actor:
reply(&quot;Say Hi to Hull&quot; =&gt; &quot;hull&quot; =&gt; 0)
# connect pending transition:
say(&quot;How do you do?&quot;) reply(&quot;Fine!&quot;) say(&quot;Let&#39;sa go!&quot;) reply(exit)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2453-L2479">source</a></section></article><h3 id="State-labels"><a class="docs-heading-anchor" href="#State-labels">State labels</a><a id="State-labels-1"></a><a class="docs-heading-anchor-permalink" href="#State-labels" title="Permalink"></a></h3><p>Numeric state keys correspond in principle to original game dialog. New labels should use strings.</p><p>Label strings are namespaced to avoid collisions.</p><p>Internally, a numeric label is produced by hashing the strings (to 64-bit integers). This allows adding approximately 2³² states (4 billion) to any actor before risking a key collision, and approximately 2⁵⁰ states before hitting any target lower than 16000 (where original game labels presumably reside).</p><h3 id="Final-transitions"><a class="docs-heading-anchor" href="#Final-transitions">Final transitions</a><a id="Final-transitions-1"></a><a class="docs-heading-anchor-permalink" href="#Final-transitions" title="Permalink"></a></h3><h3 id="Chaining-and-implicit-transitions"><a class="docs-heading-anchor" href="#Chaining-and-implicit-transitions">Chaining and implicit transitions</a><a id="Chaining-and-implicit-transitions-1"></a><a class="docs-heading-anchor-permalink" href="#Chaining-and-implicit-transitions" title="Permalink"></a></h3><h3 id="Pending-transitions"><a class="docs-heading-anchor" href="#Pending-transitions">Pending transitions</a><a id="Pending-transitions-1"></a><a class="docs-heading-anchor-permalink" href="#Pending-transitions" title="Permalink"></a></h3><p>The implicit transitions created by chaining are all text-less transitions. If PC comments are needed, this can be done via pending transitions.</p><p>A pending transition is a transition with no target state indicated. The transition will be connected to the next state to be added. Inserting such transitions in the middle of a <code>say</code> chain has the effect of inserting PC text while maintaining the structure of the chain: for example, <code>say(A); reply(a); say(B)</code> is equivalent to <code>say(A); reply(a =&gt; labelB); say(labelB =&gt; B)</code>, without the need to give an explicit label to the target state.</p><p>The current pending transition must be connected (by calling <code>say</code> or <code>interject</code>, both of which always resolve existing pending transitions) before any other transition is created (by calling <code>reply</code>).</p><h2 id="Extending-existing-dialogs"><a class="docs-heading-anchor" href="#Extending-existing-dialogs">Extending existing dialogs</a><a id="Extending-existing-dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Extending-existing-dialogs" title="Permalink"></a></h2><p>The <code>from</code> function allows changing the value of the “last added state” variable to any actor and any state.</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.from" href="#InfinityEngine.from"><code>InfinityEngine.from</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">from([game], [actor], label)</code></pre><p>Sets current state to <code>actor</code>, <code>label</code>. The state must exist.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2411-L2415">source</a></section></article><p>Note that this is not always the same actor as the speaking actor selected by <code>actor</code>: namely, <code>from</code> selects a <em>source</em> actor (i.e. already existing states), whereas <code>actor</code> selects a <em>target</em> actor, for which states will be inserted.</p><p>With a combination of <code>from</code>, <code>actor</code> and <code>reply</code> it is possible to extend existing states for an actor (by adding new transitions) and to add new states.</p><pre><code class="language-julia hljs">from(&quot;imoen&quot;, 0)
reply(&quot;Oh, hi Imoen!&quot; =&gt; &quot;new state&quot;)
say(&quot;new state&quot; =&gt; &quot;Hi you! Now we go on to our normal conversation.&quot;)</code></pre><h2 id="Inserting-into-existing-dialogs"><a class="docs-heading-anchor" href="#Inserting-into-existing-dialogs">Inserting into existing dialogs</a><a id="Inserting-into-existing-dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Inserting-into-existing-dialogs" title="Permalink"></a></h2><p>New states can also be inserted into an existing transition. Say that <code>A</code> is the last created (source) state, with transitions <code>tᵢ</code> to states <code>Bᵢ</code>: <code>A ——tᵢ——→ Bᵢ</code>. The function <code>interject</code> can insert a new state <code>X</code> at the tail end of all the arrows <code>tᵢ</code>: <code>A ——→X——tᵢ——→Bᵢ</code>. Namely, there is now a single text-less transition from <code>A</code> to <code>X</code>, and all the original transitions from <code>A</code> now start from state <code>X</code>.</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.interject" href="#InfinityEngine.interject"><code>InfinityEngine.interject</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">interject({text | (label =&gt; text)}*; priority, trigger)</code></pre><p>Inserts text inside existing dialog. The new state(s) are inserted just after the current state, using tail insertions. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2425-L2429">source</a></section></article><p><code>interject</code> moves the “source state” pointer to the newly created state <code>X</code>, so that it is possible to chain calls. For example, after <code>from(A); interject(X); interject(Y)</code>, the result will be something like <code>A——→X——→Y——tᵢ——→Bᵢ</code>.</p><h3 id="interject-and-pending-transitions"><a class="docs-heading-anchor" href="#interject-and-pending-transitions"><code>interject</code> and pending transitions</a><a id="interject-and-pending-transitions-1"></a><a class="docs-heading-anchor-permalink" href="#interject-and-pending-transitions" title="Permalink"></a></h3><p>If the source state <code>A</code> has a pending transition when <code>interject</code> is called, then instead of creating a new text-less transition <code>A→X</code>, this pending transition is used (and connected) instead. This allows replacing the default text-less transition <code>A→X</code> by a transition with text <code>A——x—→X</code> in the following way: <code>from(A); reply(x); interject(X)</code>.</p><h2 id="Deleting-existing-dialogs"><a class="docs-heading-anchor" href="#Deleting-existing-dialogs">Deleting existing dialogs</a><a id="Deleting-existing-dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Deleting-existing-dialogs" title="Permalink"></a></h2><p>Not currently possible (and not a very high priority).</p><h2 id="Attaching-data-to-dialogs"><a class="docs-heading-anchor" href="#Attaching-data-to-dialogs">Attaching data to dialogs</a><a id="Attaching-data-to-dialogs-1"></a><a class="docs-heading-anchor-permalink" href="#Attaching-data-to-dialogs" title="Permalink"></a></h2><p><strong>TODO</strong>.</p><h3 id="State-priority"><a class="docs-heading-anchor" href="#State-priority">State priority</a><a id="State-priority-1"></a><a class="docs-heading-anchor-permalink" href="#State-priority" title="Permalink"></a></h3><h3 id="Triggers"><a class="docs-heading-anchor" href="#Triggers">Triggers</a><a id="Triggers-1"></a><a class="docs-heading-anchor-permalink" href="#Triggers" title="Permalink"></a></h3><h3 id="Actions-and-journal"><a class="docs-heading-anchor" href="#Actions-and-journal">Actions and journal</a><a id="Actions-and-journal-1"></a><a class="docs-heading-anchor-permalink" href="#Actions-and-journal" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.trigger" href="#InfinityEngine.trigger"><code>InfinityEngine.trigger</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">trigger(string)</code></pre><p>Attaches a trigger to the <strong>next</strong> transition or state.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2497-L2500">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.action" href="#InfinityEngine.action"><code>InfinityEngine.action</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">action(string)</code></pre><p>Attaches an action to the latest transition.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2502-L2505">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.journal" href="#InfinityEngine.journal"><code>InfinityEngine.journal</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">journal(string)</code></pre><p>Attaches a journal entry to the latest transition.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2508-L2511">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../items/">« Items</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 21 September 2022 20:29">Wednesday 21 September 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
