<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · InfinityEngine.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>InfinityEngine.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Running-the-module"><span>Running the module</span></a></li><li><a class="tocitem" href="#Accessing-game-resources"><span>Accessing game resources</span></a></li><li><a class="tocitem" href="#Resource-references-and-namespaces"><span>Resource references and namespaces</span></a></li><li><a class="tocitem" href="#Languages"><span>Languages</span></a></li></ul></li><li><a class="tocitem" href="items/">Items</a></li><li><a class="tocitem" href="dialogs/">Dialogs</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/plut/InfinityEngine.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Home"><a class="docs-heading-anchor" href="#Home">Home</a><a id="Home-1"></a><a class="docs-heading-anchor-permalink" href="#Home" title="Permalink"></a></h1><p>This package provides an interface to Bioware&#39;s Infinity Engine games databases.</p><div class="admonition is-warning"><header class="admonition-header">Support</header><div class="admonition-body"><p>Currently, only BG(2)EE games (including EET) are supported. Supporting other games is a long-term goal.</p></div></div><h2 id="Running-the-module"><a class="docs-heading-anchor" href="#Running-the-module">Running the module</a><a id="Running-the-module-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-module" title="Permalink"></a></h2><p>The central access point for all information related to a particular game installation is the <code>Game</code> data structure. Most of the functions of this module take a <code>Game</code> value as their first argument. For convenience, this argument can be omitted; in this case, the module will use its own global <code>Game</code> structure instead.</p><p>The <code>Game</code> structure is initialized from the directory containing the <code>&quot;chitin.key&quot;</code> file.</p><pre><code class="language-julia hljs">using InfinityEngine
InfinityEngine.init!(&quot;/home/CHARNAME/baldursgate&quot;)
InfinityEngine.game()</code></pre><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.init!" href="#InfinityEngine.init!"><code>InfinityEngine.init!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">init!(directory)</code></pre><p>Initializes the global game structure from this directory (the directory containing the <code>chitin.key</code> file).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2633-L2637">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.commit" href="#InfinityEngine.commit"><code>InfinityEngine.commit</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">commit([game])</code></pre><p>Saves all changed game data to the disk installation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2516-L2519">source</a></section></article><h3 id="Game-information-status"><a class="docs-heading-anchor" href="#Game-information-status">Game information status</a><a id="Game-information-status-1"></a><a class="docs-heading-anchor-permalink" href="#Game-information-status" title="Permalink"></a></h3><p>All information related to a particular installation can be retrieved from the corresponding <code>Game</code> object. However, this is only saved to the filesystem when the <a href="#InfinityEngine.commit"><code>commit</code></a> function is called. This call saves game resources to the <code>override</code> directory, as well as extra persistent information in the state file <code>GAMEDIR/state.toml</code>.</p><p>Such information contains:</p><ul><li>the mapping between filesystem resource names (8 bytes max) and Julia-side symbolic resource names (namespaced, arbitrary strings);</li><li>TODO translation information for game strings;</li></ul><h2 id="Accessing-game-resources"><a class="docs-heading-anchor" href="#Accessing-game-resources">Accessing game resources</a><a id="Accessing-game-resources-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-game-resources" title="Permalink"></a></h2><p>The <code>Game</code> structure works as an index for all game information, including game resources (items, creatures, scripts...) and strings.</p><p>Resources of a given type are accessed via either selector functions (e.g. <code>item(&quot;sw1h01&quot;)</code> is a bastard sword) or iterators (e.g. <code>for itm in items()...</code>). Iterator functions generally are the plural form of selectors.</p><p>The following resource types are currently implemented; each one of them is described in its own documentation page:</p><ul><li><a href="@ref `InfinityEngine.Item`"><code>Item</code></a>: game items;</li><li><a href="@ref `InfinityEngine.Actor`"><code>Actor</code></a>: game dialogs;</li></ul><h3 id="Editing-resources"><a class="docs-heading-anchor" href="#Editing-resources">Editing resources</a><a id="Editing-resources-1"></a><a class="docs-heading-anchor-permalink" href="#Editing-resources" title="Permalink"></a></h3><p>Game objects are handled as ordinary Julia structures:</p><pre><code class="language-julia hljs">albruin = item(&quot;sw1h34&quot;) # long sword Albruin
albruin.min_strength = 15 # silently marks the item for commit</code></pre><p>The assignment operators are silently overloaded so that they mark all modified game objects for commit to the <code>override</code> directory.</p><p>Dialogs have their own syntax for edition; see the <a href="dialogs/#InfinityEngine.say"><code>say</code></a>, <a href="dialogs/#InfinityEngine.reply"><code>reply</code></a> etc. functions.</p><h2 id="Resource-references-and-namespaces"><a class="docs-heading-anchor" href="#Resource-references-and-namespaces">Resource references and namespaces</a><a id="Resource-references-and-namespaces-1"></a><a class="docs-heading-anchor-permalink" href="#Resource-references-and-namespaces" title="Permalink"></a></h2><p>From the user point of view, resources are always referred to by strings. The module implements resource namespaces to prevent interference between different authors. Internally, each resource string is prefixed by a namespace, in the form <code>&quot;namespace/resource&quot;</code>. The current namespace is set by the <code>namespace()</code> function.</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.namespace" href="#InfinityEngine.namespace"><code>InfinityEngine.namespace</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">namespace([game], s)</code></pre><p>Sets the current namespace for game resources being defined to <code>s</code>. The following default namespaces are used:</p><ul><li><code>&quot;&quot;</code> for original game resources;</li><li><code>&quot;user&quot;</code> is the default namespace for added resources.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L2278-L2285">source</a></section></article><p>The empty namespace <code>&quot;&quot;</code> is reserved for resources handled outside of this module (e.g. original game resources). At module initialization, the namespace is set to <code>&quot;user&quot;</code>.</p><p>The user can designate a resource by a string using the following forms:</p><ul><li><code>&quot;resource&quot;</code> will look for an existing resource first in the current namespace, then (if not found) in the empty namespace, and if not found there, it will use the current namespace;</li><li><code>&quot;ns/resource&quot;</code> identifies a resource in namespace <code>&quot;ns&quot;</code>;</li><li>in particular, <code>&quot;/resource&quot;</code> explicitly identifies a resource in the empty namespace.</li></ul><p>This means that most of the time, the non-qualified <code>&quot;resource&quot;</code> form will be enough: it either points to a (known) main-game resource, or otherwise to a resource in the module&#39;s own namespace. This provides namespace separation with minimal work from mod authors.</p><h2 id="Languages"><a class="docs-heading-anchor" href="#Languages">Languages</a><a id="Languages-1"></a><a class="docs-heading-anchor-permalink" href="#Languages" title="Permalink"></a></h2><p>Game strings are strings which will be displayed by the game engine, and which will be translated to the player&#39;s selected game language. Everywhere a game string is required (in dialogs, item names and descriptions, etc.) the string must be entered in the source in the form <code>_&quot;string&quot;</code>; the leading underscore marks this string for translation (à la <code>gettext</code>).</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.MarkedStrings.@__str" href="#InfinityEngine.MarkedStrings.@__str"><code>InfinityEngine.MarkedStrings.@__str</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">_&quot;text&quot;</code></pre><p>A marker for text that needs to be translated. This does nothing by itself (it is equivalent to <code>&quot;text&quot;</code>), but it marks the string for parsing to a <code>&quot;.pot&quot;</code> file.</p><p><strong>Comments</strong></p><p>Any consecutive block of comments of up to 5 lines just before the string is appended to the <code>&quot;.pot&quot;</code> file. These comments will thus be visible to any translators. Don&#39;t hesitate to use them to write useful context.</p><p><strong>String markers</strong></p><p>Strings may contain markers of the form <code>?{marker}</code>. Such markers are discarded before saving the string to game files. However, they will be included in strings marked for translation. They can therefore be used to distinguish two strings which are identical in the original language (e.g. English) but which could have differing translations depending on language; for example, using &quot;?{verb}Slow&quot; and &quot;?{adjective}Slow&quot; could be helpful.</p><p><strong><code>&quot;dialogF.tlk&quot;</code></strong></p><p>Several languages (German, Spanish, French, Japanese, Polish, Portuguese, Russian) have a second translation file, <code>&quot;dialogF.tlk&quot;</code>, which is used when &lt;CHARNAME&gt; has female grammatical gender. Most strings are identical for both genders (for example in French, only 800 of 34000 strings differ). To make it easier to provide correct strings depending on grammatical gender, any string in the source file marked with <code>&quot;?{F}&quot;</code> or <code>&quot;?{M}&quot;</code> will output <em>two</em> variants of the string in the <code>&quot;.pot&quot;</code> file: one with the the mark replaced by <code>&quot;?{M}&quot;</code> (translation will be saved in <code>&quot;dialog.tlk&quot;</code>) and one with the mark replaced by <code>&quot;?{F}&quot;</code> (translation will be saved in <code>&quot;dialogF.tlk&quot;</code>).</p><p>It is advised to use such a mark on every sentence that grammatically refers to &lt;CHARNAME&gt; in any way. The translator may choose to leave either translation empty. In this case, the other translation will be used. (This means that superfluous <code>&quot;?{[FM}}&quot;</code> marks demand almost no extra work from the translator).</p><p>A translator seeing a string which would require two translations, but which is not marked with <code>&quot;?{[FM]}&quot;</code> can also edit the <code>.po</code> file to include both versions (however contacting the author to correctly mark the input string is preferred).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/markedstrings.jl#L5-L53">source</a></section></article><p>As all strings in Julia code, <strong>game strings MUST be entered in the UTF-8 encoding</strong>.</p><p>When assigned to relevant properties of game objects (for example as object properties or dialog texts), such strings are converted to <code>Strref</code> (numeric string references). Translations for the strings are loaded from <code>.po</code> files (in the standard format used by <code>gettext</code>, with tiny adaptations for gendered languages), loaded by the <code>load_translations!</code> function</p><article class="docstring"><header><a class="docstring-binding" id="InfinityEngine.load_translations!" href="#InfinityEngine.load_translations!"><code>InfinityEngine.load_translations!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">load_translations!([directory])</code></pre><p>Loads translations from all <code>.po</code> files in <code>directory</code> inside the game structures.</p><p>If <code>directory</code> is not provided, the default value is the directory containing the calling <code>.jl</code> file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/plut/InfinityEngine.jl/blob/4d9aa23f10d43a50fe3d0a9656eaf04cdc8e5ec5/src/InfinityEngine.jl#L1945-L1952">source</a></section></article><p>and saved in all <code>dialog.tlk</code> and <code>dialogF.tlk</code> files. For strings for which no translation is provided, the string itself will be used instead.</p><p>The workflow for a mod author is thus the following:</p><ol><li>systematically mark all game strings using the <code>_&quot;string&quot;</code> syntax (the module will help by throwing errors when the mark is forgotten);</li><li>whenever a string by itself would be ambiguous (e.g. <code>&quot;Fine!&quot;</code>), don&#39;t hesitate to provide extra context by prefixing it by a number of comment lines clarifying its meaning: comment lines immediately preceding a translated string will be extracted to the <code>.pot</code> file and shown to translators.</li><li>Short omments can also be included in the string using <code>?{keyword}</code> insertions: these will be automatically deleted when output to game files.</li><li>Finally produce the translation template <code>mod.pot</code> by running the <code>write_pot</code> function:</li></ol><pre><code class="language-julia hljs">InfinityEngine.MarkedStrings.write_pot(&quot;source_file.jl&quot;, &quot;mod.pot&quot;)</code></pre><p>TODO: automatize this a bit more.</p><p>Workflow for translator (for the example, the French translator, working on file <code>fr.po</code>):</p><ol><li>either initialize or update the <code>.po</code> file with the commands <code>msginit -i mod.pot -o fr.po</code> or <code>msgmerge -U mod.pot fr.po</code>;</li><li>do the actual translation work with your preferred <code>.po</code> editing program (e.g. <code>POEdit</code>)</li></ol><h3 id="Gendered-languages"><a class="docs-heading-anchor" href="#Gendered-languages">Gendered languages</a><a id="Gendered-languages-1"></a><a class="docs-heading-anchor-permalink" href="#Gendered-languages" title="Permalink"></a></h3><p>Some game languages are gendered: these language use two language files, <code>dialog.tlk</code> and <code>dialogF.tlk</code>, depending on the grammatical gender of CHARNAME. Since most game strings (about 90% for French) are unchanged between both files, it is a necessity to help the translator work on both files at once.</p><p>Any marked string containing either the <code>?{F}</code> or <code>?{M}</code> keyword will be output in the <code>.pot</code> file as <em>two</em> variants: a variant marked with <code>?{M}</code>, whose translation will be saved to <code>dialog.tlk</code>, and a variant marked with <code>?{F}</code>, whose translation will be saved to <code>dialogF.tlk</code>. (As a fall-back, if only one of these is translated, then it will be used for both files).</p><p>It is thus advised to include a <code>?{M}</code> (or <code>?{F}</code>) mark in every game string which grammatically refers to &lt;CHARNAME&gt;. This helps the translator; even superfluous marks demand no extra work for them, since they can always leave one of the translations empty and the module will then use the other one, thus making both translations identical.</p><p>For a short example, assume that the source string is:</p><pre><code class="language-julia hljs">_&quot;?{M}Be strong, &lt;CHARNAME&gt;!&quot;</code></pre><p>Such a string will be extracted to two <code>.pot</code> entries:</p><pre><code class="language-pot hljs">msgid &quot;?{M}Be strong, &lt;CHARNAME&gt;!&quot;

msgid &quot;?{F}Be strong, &lt;CHARNAME&gt;!&quot;</code></pre><p>This could be translated in French as two different messages:</p><pre><code class="language-pot hljs">msgid &quot;?{M}Be strong, &lt;CHARNAME&gt;!&quot;
msgstr &quot;Sois fort, &lt;CHARNAME&gt; !&quot;

msgid &quot;?{F}Be strong, &lt;CHARNAME&gt;!&quot;
msgstr &quot;Sois forte, &lt;CHARNAME&gt; !&quot;</code></pre><p>However, in German this is gender-invariant, so the German translator can always leave one of the strings empty:</p><pre><code class="language-pot hljs">msgid &quot;?{M}Be strong, &lt;CHARNAME&gt;!&quot;
msgstr &quot;&quot;

msgid &quot;?{F}Be strong, &lt;CHARNAME&gt;!&quot;
msgstr &quot;Sei stark, &lt;CHARNAME&gt;!&quot;</code></pre><p>The non-empty message will then be saved to both <code>de_DE/dialog.tlk</code> and <code>de_DE/dialogF.tlk</code>.</p><p>A translator seeing a string which requires gender-dependent translation, but unmarked in the source file, can always manually edit the <code>.po</code> file to include both versions; however, contacting the source file author to correctly mark the input is more robust and is the preferred solution.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="items/">Items »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 21 September 2022 20:30">Wednesday 21 September 2022</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
